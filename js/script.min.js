!function(){!function(){let e=document.querySelector(".team__list");e.addEventListener("click",function(t){if(t.preventDefault(),t.target.classList.contains("member__link")){let n=t.target,i=e.querySelector(".member.is-active");if(i&&(i.querySelector(".member__text").style.height="0px",i.classList.remove("is-active")),!i||i.querySelector(".member__link")!=n){let e=n.closest(".member");e.classList.add("is-active");let t=e.querySelector(".member__text");t.style.height=t.scrollHeight+"px"}}})}(),function(){let e=document.querySelectorAll(".menu__block"),t=document.querySelector("body");e.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();let n=this,i=document.querySelector(".menu__item.is-active");if(i&&(i.querySelector(".menu__desc").style.width="0px",i.classList.remove("is-active")),!i||i.querySelector(".menu__block")!=n){let e=n.closest(".menu__item");e.classList.add("is-active");let i=e.querySelector(".menu__desc");t.offsetWidth>480?i.style.width=function(){let e=document.documentElement.clientWidth,t=document.querySelectorAll(".menu__block"),n=e-parseFloat(getComputedStyle(t[0]).width)*t.length;return n>550?550:n}()+"px":i.style.width="auto"}})})}()}(),$(function(){let e=$(".candy-bar__slider");$(".scroll-btn").on("click",function(t){t.preventDefault();let n,i,o=$(this),l=e.find(".candy-bar__item"),a=l.filter(".active");o.hasClass("scroll-btn--forward")&&(n=a.next(),i=l.first()),o.hasClass("scroll-btn--back")&&(n=a.prev(),i=l.last()),function(t){let n=e.find(".candy-bar__item"),i=n.filter(".active"),o=n.eq(t),l=o.index(),a=e.find(".candy-bar__list");o.length&&a.animate({left:100*-l+"%"},500,function(){i.removeClass("active"),o.addClass("active")})}(n.length?n.index():i.index())})}),ymaps.ready(init);var geoObjects=[],marks=[{latitude:55.7587,longitude:37.5828,hintContent:'<div class="map__hint">Кудринская площадь д.1</div>'},{latitude:55.7427,longitude:37.5799,hintContent:'<div class="map__hint">ул.Плющиха д.11</div>'},{latitude:55.7574,longitude:37.6208,hintContent:'<div class="map__hint">Площадь Революции д.1</div>'},{latitude:55.75,longitude:37.6037,hintContent:'<div class="map__hint">Большой Знаменский пер. д.23</div>'}];function init(){var e=new ymaps.Map("map",{center:[55.75269656,37.59427083],zoom:14,controls:["zoomControl"],behaviors:["drag"]});/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&e.behaviors.disable("drag");for(let e=0;e<marks.length;e++)geoObjects[e]=new ymaps.Placemark([marks[e].latitude,marks[e].longitude],{hintContent:marks[e].hintContent},{iconLayout:"default#image",iconImageHref:"./img/marker.png",iconImageSize:[46,57],iconImageOffset:[-23,-57]});var t=new ymaps.Clusterer({clusterIcons:[{href:"./img/marker.png",size:[46,57],offset:[-23,-57]}],clusterIconContentLayout:null});e.geoObjects.add(t),t.add(geoObjects)}const menu=function(){let e=document.querySelector(".menu-btn"),t=document.querySelector(".header"),n=document.querySelector("body"),i=document.querySelector(".nav__list"),o=!1;function l(){e.classList.toggle("is-active"),t.classList.toggle("is-active"),n.classList.toggle("locked"),o=!o}return document.addEventListener("keydown",function(e){27==e.keyCode&&o&&l()}),{menuOver:function(){e.addEventListener("click",l),i.addEventListener("click",function(e){e.target.classList.contains("nav__link")&&n.offsetWidth<=768&&l()})}}}();menu.menuOver();let OnePageScroll=function(){const e=document,t=e.querySelector(".wrapper"),n=e.querySelector("#content"),i=e.querySelectorAll(".section"),o=e.querySelectorAll(".nav__link"),l=e.querySelectorAll(".listing__item"),a=e.querySelector(".listing");let c,s=!1;const r=/Android|AppleWebKit|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function d(t){if(!s){s=!0;let o=-100*t+"%";n.style.top=o,i[t].classList.contains("white")?a.classList.remove("grey"):a.classList.add("grey"),e.querySelector(".listing__item.is-active").classList.remove("is-active"),l[t].classList.add("is-active"),setTimeout(function(){s=!1},900)}}function u(e){let t=n.style.top?-parseInt(n.style.top)/100:0;"up"==e&&t>0&&d(t-1),"down"==e&&t<i.length-1&&d(t+1)}t.addEventListener("wheel",function(e){u(e.deltaY<0?"up":"down")}),t.addEventListener("touchmove",function(e){e.preventDefault()}),t.addEventListener("touchstart",function(e){r&&(c=e.touches[0].clientY)},!1),t.addEventListener("touchend",function(e){let t=e.changedTouches[0].clientY-c;if(Math.abs(t)>50){u(t>0?"up":"down")}},!1),o.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),d(this.dataset.index)})}),a.addEventListener("click",function(e){let t=e.target;if(t.classList.contains("listing__link")){e.preventDefault(),d(t.dataset.index)}}),e.querySelectorAll(".button-link").forEach(function(e){e.addEventListener("click",function(e){e.preventDefault(),d(this.dataset.index)})}),e.addEventListener("keyup",function(e){let t;38===e.keyCode&&(t="up"),40===e.keyCode&&(t="down"),u(t)})};OnePageScroll();const overlay=function(){let e=document.querySelector("body"),t=document.querySelector(".modal"),n=document.querySelector(".modal__inner"),i=document.createElement("div");i.classList.add("modal__text");let o=function(){t.classList.remove("is-active"),e.classList.remove("locked")};return{open:function(l,a){let c=document.createElement("button");i.textContent=l,n.innerHTML="",a?(c.classList.add("order-button"),c.textContent="Закрыть"):c.classList.add("modal__close"),n.appendChild(i),n.appendChild(c),t.classList.add("is-active"),e.classList.add("locked"),c.addEventListener("click",e=>{e.preventDefault(),o()}),t.addEventListener("click",e=>{e.target===t&&o()}),document.addEventListener("keydown",e=>{27===e.keyCode&&o()})},close:o}}(),ajaxForm=function(e){let t=new FormData;t.append("name",e.elements.name.value),t.append("phone",e.elements.phone.value),t.append("comment",e.elements.textarea.value),t.append("to","client@mail.ru");const n=new XMLHttpRequest;return n.responseType="json",n.open("POST","https://webdev-api.loftschool.com/sendmail"),n.setRequestHeader("X-Requested-With","XMLHttpRequest"),n.send(t),n},submitForm=function(){let e=document.querySelector("#order-form");if(validateForm(e)){let t=ajaxForm(e);t.addEventListener("load",()=>{let e=!1;if(t.status>=400){let n="Ошибка соединения с сервером, попробуйте позже";overlay.open(`${n}. Ошибка ${t.status}`,e)}else 0==t.response.status?(content=t.response.message,overlay.open(content,e)):(content="Сообщение отправлено",e=!0,overlay.open(content,e))})}};function validateForm(e){let t=!0;return validateField(e.elements.name)||(t=!1),validateField(e.elements.phone)||(t=!1),validateField(e.elements.textarea)||(t=!1),t}function validateField(e){return e.nextElementSibling.textContent=e.validationMessage,e.checkValidity()}let orderBtn=document.querySelector("#send");orderBtn.addEventListener("click",e=>{e.preventDefault(),submitForm()}),function(){const e=document.querySelectorAll(".reviews__item"),t=document.querySelectorAll(".reviews__pix-item");let n=0;for(let i=0;i<e.length;i++)t[i].addEventListener("click",function(o){o.preventDefault(),e[i].classList.toggle("is-active"),t[i].classList.toggle("is-active"),t[n].classList.toggle("is-active"),e[n].classList.toggle("is-active"),n=i})}(),document.addEventListener("DOMContentLoaded",function(){!function(){let e=document.querySelector(".video__content"),t=document.querySelector(".video__btn"),n=document.querySelector(".video__play"),i=document.querySelector(".video__range--volume"),o=document.querySelector(".video__range--progress"),l=document.querySelector(".video__sound-img"),a=!1;function c(){o.max=100,a=!0,function(){let t=e.duration;d.textContent=m(t)}()}function s(){r(),e.paused?e.play():e.pause()}function r(){t.classList.toggle("hidden"),n.classList.toggle("pause")}i.min=0,i.max=10,o.value=0;let d=document.querySelector(".video__time-estimated"),u=document.querySelector(".video__time-completed");function m(e){let t=Math.round(e),n=Math.floor(t/60),i=t-60*n;return`${n}:${i<10?`0${i}`:i}`}t.addEventListener("click",function(){c(),s()}),n.addEventListener("click",function(){c(),s()}),e.addEventListener("timeupdate",function(){!function(){let t=e.duration,n=e.currentTime,i=o.max;o.value=n/t*i}(),function(){let t=e.currentTime;u.textContent=m(t)}()}),e.addEventListener("click",function(){e.paused||(e.pause(),r())}),e.addEventListener("ended",function(){r(),e.currentTime=0},!1),o.addEventListener("mousedown",function(){a&&(t.classList.add("hidden"),n.classList.add("pause")),e.pause()}),o.addEventListener("input",function(){let t=o.value,n=o.max;e.currentTime=e.duration*(t/n)}),o.addEventListener("mouseup",function(){a&&e.play()}),i.addEventListener("input",function(){let t=i.value;e.volume=t/10}),l.addEventListener("click",function(){0===e.volume?(e.volume=soundLevel,i.value=10*soundLevel):(soundLevel=e.volume,e.volume=0,i.value=0)})}()},!1);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGVvbi5qcyIsImpxdWVyeVNsaWRlci5qcyIsIm1hcC5qcyIsIm1lbnUuanMiLCJvcHMuanMiLCJyZXF1ZXN0LmpzIiwic2xpZGVzaG93LmpzIiwidmlkZW8uanMiXSwibmFtZXMiOlsidGVhbSIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwicHJldmVudERlZmF1bHQiLCJ0YXJnZXQiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsImxpbmsiLCJhY3RpdmUiLCJzdHlsZSIsImhlaWdodCIsInJlbW92ZSIsImN1cnJlbnQiLCJjbG9zZXN0IiwiYWRkIiwiY3VycmVudFRleHQiLCJzY3JvbGxIZWlnaHQiLCJhY3RpdmF0ZVRlYW0iLCJsaW5rcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJib2R5IiwiZm9yRWFjaCIsImVsZW0iLCJ0aGlzIiwid2lkdGgiLCJvZmZzZXRXaWR0aCIsImRvY3VtZW50RWxlbWVudCIsImNsaWVudFdpZHRoIiwicmVxV2lkdGgiLCJwYXJzZUZsb2F0IiwiZ2V0Q29tcHV0ZWRTdHlsZSIsImxlbmd0aCIsIndpZHRoQ2FsYyIsImFjdGl2YXRlTWVudSIsIiQiLCJzbGlkZXIiLCJvbiIsImV4aXN0ZWRJdGVtIiwiZWRnZUl0ZW0iLCIkdGhpcyIsIml0ZW1zIiwiZmluZCIsImFjdGl2ZUl0ZW0iLCJmaWx0ZXIiLCJoYXNDbGFzcyIsIm5leHQiLCJmaXJzdCIsInByZXYiLCJsYXN0IiwibnVtIiwicmVxSXRlbSIsImVxIiwicmVxSW5kZXgiLCJpbmRleCIsImxpc3QiLCJhbmltYXRlIiwibGVmdCIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJtb3ZlU2xpZGUiLCJ5bWFwcyIsInJlYWR5IiwiaW5pdCIsImdlb09iamVjdHMiLCJtYXJrcyIsImxhdGl0dWRlIiwibG9uZ2l0dWRlIiwiaGludENvbnRlbnQiLCJtYXAiLCJNYXAiLCJjZW50ZXIiLCJ6b29tIiwiY29udHJvbHMiLCJiZWhhdmlvcnMiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiZGlzYWJsZSIsImkiLCJQbGFjZW1hcmsiLCJpY29uTGF5b3V0IiwiaWNvbkltYWdlSHJlZiIsImljb25JbWFnZVNpemUiLCJpY29uSW1hZ2VPZmZzZXQiLCJjbHVzdGVyZXIiLCJDbHVzdGVyZXIiLCJjbHVzdGVySWNvbnMiLCJocmVmIiwic2l6ZSIsIm9mZnNldCIsImNsdXN0ZXJJY29uQ29udGVudExheW91dCIsIm1lbnUiLCJidXR0b24iLCJoZWFkZXIiLCJuYXYiLCJhY3QiLCJ0b2dnbGVNZW51IiwidG9nZ2xlIiwia2V5Q29kZSIsIm1lbnVPdmVyIiwiT25lUGFnZVNjcm9sbCIsImQiLCJ3cmFwcGVyIiwiY29udGVudCIsInNlY3Rpb25zIiwibWVudUxpbmtzIiwicG9pbnRzIiwibGlzdGluZyIsImNsaWVudFkiLCJwYXVzZSIsImlzTW9iaWxlIiwibW92ZUNvbnRlbnQiLCJwb3MiLCJ0b3AiLCJzZXRUaW1lb3V0Iiwic2Nyb2xsVG8iLCJ3YXkiLCJjdXJyZW50SW5kZXgiLCJwYXJzZUludCIsImRlbHRhWSIsInRvdWNoZXMiLCJjaGFuZ2VkVG91Y2hlcyIsIk1hdGgiLCJhYnMiLCJkYXRhc2V0Iiwib3ZlcmxheSIsIm1vZGFsIiwibW9kYWxJbm5lciIsIm1vZGFsVGV4dCIsImNyZWF0ZUVsZW1lbnQiLCJjbG9zZU92ZXJsYXkiLCJvcGVuIiwicmVwbHkiLCJ0ZXh0Q29udGVudCIsImlubmVySFRNTCIsImFwcGVuZENoaWxkIiwiY2xvc2UiLCJhamF4Rm9ybSIsImZvcm0iLCJkYXRhIiwiRm9ybURhdGEiLCJhcHBlbmQiLCJlbGVtZW50cyIsIm5hbWUiLCJ2YWx1ZSIsInBob25lIiwidGV4dGFyZWEiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsInJlc3BvbnNlVHlwZSIsInNldFJlcXVlc3RIZWFkZXIiLCJzZW5kIiwic3VibWl0Rm9ybSIsInZhbGlkYXRlRm9ybSIsInJlcXVlc3QiLCJzdGF0dXMiLCJyZXNwb25zZSIsIm1lc3NhZ2UiLCJ2YWxpZCIsInZhbGlkYXRlRmllbGQiLCJmaWVsZCIsIm5leHRFbGVtZW50U2libGluZyIsInZhbGlkYXRpb25NZXNzYWdlIiwiY2hlY2tWYWxpZGl0eSIsIm9yZGVyQnRuIiwicGl4IiwidmlkZW8iLCJwbGF5QmlnIiwicGxheVNtYWxsIiwidm9sdW1lU2NhbGUiLCJwcm9ncmVzc1NjYWxlIiwibXV0ZUJ0biIsInR1cm5PbiIsInZpZGVvVHVybiIsIm1heCIsImR1cmF0aW9uIiwiZXN0aW1hdGVkRGlzcGxheSIsImZvcm1hdFRpbWUiLCJnZXREdXJhdGlvbiIsInBsYXlTdG9wIiwidG9nZ2xlQ2xhc3MiLCJwYXVzZWQiLCJwbGF5IiwibWluIiwiY29tcGxldGVkRGlzcGxheSIsInRpbWUiLCJyb3VuZFRpbWUiLCJyb3VuZCIsIm1pbnV0ZXMiLCJmbG9vciIsInNlY29uZHMiLCJjdXJyZW50VGltZSIsInByb2dyZXNzVXBkYXRlIiwiY29tcGxldGVkIiwidGltZVVwZGF0ZSIsInZvbHVtZSIsInNvdW5kTGV2ZWwiLCJ2aWRlb1BsYXllciJdLCJtYXBwaW5ncyI6IkNBQUEsWUFXQSxXQUNBLElBQUFBLEVBQUFDLFNBQUFDLGNBQUEsZUFDQUYsRUFBQUcsaUJBQUEsUUFBQSxTQUFBQyxHQUVBLEdBREFBLEVBQUFDLGlCQUNBRCxFQUFBRSxPQUFBQyxVQUFBQyxTQUFBLGdCQUFBLENBQ0EsSUFBQUMsRUFBQUwsRUFBQUUsT0FFQUksRUFBQVYsRUFBQUUsY0FBQSxxQkFPQSxHQUxBUSxJQUNBQSxFQUFBUixjQUFBLGlCQUNBUyxNQUFBQyxPQUFBLE1BQ0FGLEVBQUFILFVBQUFNLE9BQUEsZUFFQUgsR0FBQUEsRUFBQVIsY0FBQSxrQkFBQU8sRUFBQSxDQUNBLElBQUFLLEVBQUFMLEVBQUFNLFFBQUEsV0FDQUQsRUFBQVAsVUFBQVMsSUFBQSxhQUVBLElBQUFDLEVBQUFILEVBQUFaLGNBQUEsaUJBQ0FlLEVBQUFOLE1BQUFDLE9BQUFLLEVBQUFDLGFBQUEsU0FLQUMsR0FFQSxXQUNBLElBQUFDLEVB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QTZCLE9BQ0E3QixFQUFBNkIsT0FBQSxFQUNBMUIsRUFBQXpCLE1BQUEsS0FrRUFxRCxLQUNBIiwiZmlsZSI6InNjcmlwdC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtcclxuXHJcbiAgZnVuY3Rpb24gd2lkdGhDYWxjKCkge1xyXG4gICAgbGV0IHdpZHRoID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoO1xyXG4gICAgbGV0IGxpbmtzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1lbnVfX2Jsb2NrJyk7XHJcbiAgICBsZXQgbGlua1dpZHRoID0gcGFyc2VGbG9hdChnZXRDb21wdXRlZFN0eWxlKGxpbmtzWzBdKS53aWR0aCk7XHJcblxyXG4gICAgbGV0IHJlcVdpZHRoID0gd2lkdGggLSBsaW5rV2lkdGggKiBsaW5rcy5sZW5ndGg7XHJcbiAgICByZXR1cm4gcmVxV2lkdGggPiA1NTAgPyA1NTAgOiByZXFXaWR0aDtcclxuICB9XHJcbiAgXHJcbiAgZnVuY3Rpb24gYWN0aXZhdGVUZWFtKCkge1xyXG4gICAgbGV0IHRlYW0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudGVhbV9fbGlzdCcpOyAgIFxyXG4gICAgdGVhbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBpZihlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ21lbWJlcl9fbGluaycpKXtcclxuICAgICAgICBsZXQgbGluayA9IGUudGFyZ2V0O1xyXG5cclxuICAgICAgICBsZXQgYWN0aXZlID0gdGVhbS5xdWVyeVNlbGVjdG9yKCcubWVtYmVyLmlzLWFjdGl2ZScpO1xyXG5cclxuICAgICAgICBpZihhY3RpdmUpIHtcclxuICAgICAgICAgIGxldCBhY3RpdmVUZXh0ID0gYWN0aXZlLnF1ZXJ5U2VsZWN0b3IoJy5tZW1iZXJfX3RleHQnKTsgICAgICAgICAgXHJcbiAgICAgICAgICBhY3RpdmVUZXh0LnN0eWxlLmhlaWdodCA9ICcwcHgnO1xyXG4gICAgICAgICAgYWN0aXZlLmNsYXNzTGlzdC5yZW1vdmUoJ2lzLWFjdGl2ZScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZighYWN0aXZlIHx8IGFjdGl2ZS5xdWVyeVNlbGVjdG9yKCcubWVtYmVyX19saW5rJykgIT0gbGluaykge1xyXG4gICAgICAgICAgbGV0IGN1cnJlbnQgID0gbGluay5jbG9zZXN0KCcubWVtYmVyJyk7XHJcbiAgICAgICAgICBjdXJyZW50LmNsYXNzTGlzdC5hZGQoJ2lzLWFjdGl2ZScpO1xyXG5cclxuICAgICAgICAgIGxldCBjdXJyZW50VGV4dCA9IGN1cnJlbnQucXVlcnlTZWxlY3RvcignLm1lbWJlcl9fdGV4dCcpO1xyXG4gICAgICAgICAgY3VycmVudFRleHQuc3R5bGUuaGVpZ2h0ID0gY3VycmVudFRleHQuc2Nyb2xsSGVpZ2h0ICsgJ3B4JztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pICAgIFxyXG4gIH1cclxuICBhY3RpdmF0ZVRlYW0oKVxyXG5cclxuICBmdW5jdGlvbiBhY3RpdmF0ZU1lbnUoKSB7XHJcbiAgICBsZXQgbGlua3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWVudV9fYmxvY2snKTtcclxuICAgIGxldCBib2R5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpOyAgXHJcbiAgICBsaW5rcy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW0pe1xyXG4gICAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGxldCBsaW5rID0gdGhpczsgICAgICAgIFxyXG4gICAgICAgIGxldCBhY3RpdmUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubWVudV9faXRlbS5pcy1hY3RpdmUnKTtcclxuXHJcbiAgICAgICAgaWYoYWN0aXZlKSB7XHJcbiAgICAgICAgICBsZXQgYWN0aXZlVGV4dCA9IGFjdGl2ZS5xdWVyeVNlbGVjdG9yKCcubWVudV9fZGVzYycpOyAgICAgICAgICBcclxuICAgICAgICAgIGFjdGl2ZVRleHQuc3R5bGUud2lkdGggPSAnMHB4JztcclxuICAgICAgICAgIGFjdGl2ZS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKCFhY3RpdmUgfHwgYWN0aXZlLnF1ZXJ5U2VsZWN0b3IoJy5tZW51X19ibG9jaycpICE9IGxpbmspIHtcclxuICAgICAgICAgIGxldCBjdXJyZW50ICA9IGxpbmsuY2xvc2VzdCgnLm1lbnVfX2l0ZW0nKTtcclxuICAgICAgICAgIGN1cnJlbnQuY2xhc3NMaXN0LmFkZCgnaXMtYWN0aXZlJyk7XHJcblxyXG4gICAgICAgICAgbGV0IGN1cnJlbnRUZXh0ID0gY3VycmVudC5xdWVyeVNlbGVjdG9yKCcubWVudV9fZGVzYycpO1xyXG4gICAgICAgICAgaWYgKGJvZHkub2Zmc2V0V2lkdGggPiA0ODApIHtcclxuICAgICAgICAgIGN1cnJlbnRUZXh0LnN0eWxlLndpZHRoID0gd2lkdGhDYWxjKCkgKyAncHgnO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY3VycmVudFRleHQuc3R5bGUud2lkdGggPSAnYXV0byc7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSAgICAgIFxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICB9XHJcbiAgYWN0aXZhdGVNZW51KCk7ICBcclxufSgpKTtcclxuXHJcblxyXG4gICIsIiQoZnVuY3Rpb24gKCkge1xyXG4gICAgbGV0IHNsaWRlciA9ICQoJy5jYW5keS1iYXJfX3NsaWRlcicpO1xyXG4gICAgXHJcbiAgbGV0IG1vdmVTbGlkZSA9IGZ1bmN0aW9uKG51bSkge1xyXG4gICAgbGV0IGl0ZW1zID0gc2xpZGVyLmZpbmQoJy5jYW5keS1iYXJfX2l0ZW0nKTtcclxuICAgIGxldCBhY3RpdmVJdGVtID0gaXRlbXMuZmlsdGVyKCcuYWN0aXZlJyk7XHJcbiAgICBsZXQgcmVxSXRlbSA9IGl0ZW1zLmVxKG51bSk7XHJcbiAgICBsZXQgcmVxSW5kZXggPSByZXFJdGVtLmluZGV4KCk7XHJcbiAgICBsZXQgbGlzdCA9IHNsaWRlci5maW5kKCcuY2FuZHktYmFyX19saXN0Jyk7XHJcbiAgICBsZXQgZHVyYXRpb24gPSA1MDA7XHJcbiAgICBpZiAocmVxSXRlbS5sZW5ndGgpIHtcclxuICAgICAgbGlzdC5hbmltYXRlKHtcclxuICAgICAgICAnbGVmdCc6IC1yZXFJbmRleCAqIDEwMCArJyUnXHJcbiAgICAgIH0sIGR1cmF0aW9uLCBmdW5jdGlvbigpIHtcclxuICAgICAgICBhY3RpdmVJdGVtLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgICByZXFJdGVtLmFkZENsYXNzKCdhY3RpdmUnKTtcclxuICAgICAgfSlcclxuICAgIH1cclxuICB9XHJcbiAgXHJcbiAgJCgnLnNjcm9sbC1idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBsZXQgJHRoaXMgPSAkKHRoaXMpO1xyXG4gICAgbGV0IGl0ZW1zID0gc2xpZGVyLmZpbmQoJy5jYW5keS1iYXJfX2l0ZW0nKTtcclxuICAgIGxldCBhY3RpdmVJdGVtID0gaXRlbXMuZmlsdGVyKCcuYWN0aXZlJyk7XHJcbiAgICBsZXQgZXhpc3RlZEl0ZW07XHJcbiAgICBsZXQgZWRnZUl0ZW07XHJcblxyXG4gICAgaWYgKCR0aGlzLmhhc0NsYXNzKCdzY3JvbGwtYnRuLS1mb3J3YXJkJykpIHtcclxuICAgICAgZXhpc3RlZEl0ZW0gPSBhY3RpdmVJdGVtLm5leHQoKTtcclxuICAgICAgZWRnZUl0ZW0gPSBpdGVtcy5maXJzdCgpOyAgICAgXHJcbiAgICB9IFxyXG4gICAgaWYgKCR0aGlzLmhhc0NsYXNzKCdzY3JvbGwtYnRuLS1iYWNrJykpIHtcclxuICAgICAgZXhpc3RlZEl0ZW0gPSBhY3RpdmVJdGVtLnByZXYoKTtcclxuICAgICAgZWRnZUl0ZW0gPSBpdGVtcy5sYXN0KCk7ICAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlcUl0ZW0gPSBleGlzdGVkSXRlbS5sZW5ndGggPyBleGlzdGVkSXRlbS5pbmRleCgpIDogZWRnZUl0ZW0uaW5kZXgoKTtcclxuICAgIG1vdmVTbGlkZShyZXFJdGVtKTtcclxuICAgIH0pXHJcbn0pIiwieW1hcHMucmVhZHkoaW5pdCk7XHJcbiAgdmFyIGdlb09iamVjdHM9IFtdO1xyXG4gIHZhciBtYXJrcyA9IFtcclxuICAgIHtcclxuICAgICAgbGF0aXR1ZGU6IDU1Ljc1ODcsXHJcbiAgICAgIGxvbmdpdHVkZTogMzcuNTgyOCxcclxuICAgICAgaGludENvbnRlbnQ6ICc8ZGl2IGNsYXNzPVwibWFwX19oaW50XCI+0JrRg9C00YDQuNC90YHQutCw0Y8g0L/Qu9C+0YnQsNC00Ywg0LQuMTwvZGl2PicsXHJcbiAgICB9LFxyXG4gICAge1xyXG4gICAgICBsYXRpdHVkZTogNTUuNzQyNyxcclxuICAgICAgbG9uZ2l0dWRlOiAzNy41Nzk5LFxyXG4gICAgICBoaW50Q29udGVudDogJzxkaXYgY2xhc3M9XCJtYXBfX2hpbnRcIj7Rg9C7LtCf0LvRjtGJ0LjRhdCwINC0LjExPC9kaXY+JyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGxhdGl0dWRlOiA1NS43NTc0LFxyXG4gICAgICBsb25naXR1ZGU6IDM3LjYyMDgsXHJcbiAgICAgIGhpbnRDb250ZW50OiAnPGRpdiBjbGFzcz1cIm1hcF9faGludFwiPtCf0LvQvtGJ0LDQtNGMINCg0LXQstC+0LvRjtGG0LjQuCDQtC4xPC9kaXY+JyxcclxuICAgIH0sXHJcbiAgICB7XHJcbiAgICAgIGxhdGl0dWRlOiA1NS43NTAwLFxyXG4gICAgICBsb25naXR1ZGU6IDM3LjYwMzcsXHJcbiAgICAgIGhpbnRDb250ZW50OiAnPGRpdiBjbGFzcz1cIm1hcF9faGludFwiPtCR0L7Qu9GM0YjQvtC5INCX0L3QsNC80LXQvdGB0LrQuNC5INC/0LXRgC4g0LQuMjM8L2Rpdj4nLFxyXG4gICAgfVxyXG4gIF1cclxuXHJcbmZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgdmFyIG1hcCA9IG5ldyB5bWFwcy5NYXAoJ21hcCcsIHtcclxuICAgIGNlbnRlcjogWzU1Ljc1MjY5NjU2LCAzNy41OTQyNzA4M10sXHJcbiAgICB6b29tOiAxNCxcclxuICAgIGNvbnRyb2xzOiBbJ3pvb21Db250cm9sJ10sXHJcbiAgICBiZWhhdmlvcnM6IFsnZHJhZyddXHJcbiAgfSk7XHJcbiAgbGV0IG1vYmlsZSA9IC9BbmRyb2lkfHdlYk9TfGlQaG9uZXxpUGFkfGlQb2R8QmxhY2tCZXJyeXxJRU1vYmlsZXxPcGVyYSBNaW5pL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcclxuICBpZiAobW9iaWxlKSB7XHJcbiAgICBtYXAuYmVoYXZpb3JzLmRpc2FibGUoJ2RyYWcnKTtcclxuICB9O1xyXG4gIGZvciAobGV0IGk9MDsgaTxtYXJrcy5sZW5ndGg7IGkrKykge1xyXG4gICAgZ2VvT2JqZWN0c1tpXSA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoW21hcmtzW2ldLmxhdGl0dWRlLCBtYXJrc1tpXS5sb25naXR1ZGVdLFxyXG4gICAgICB7XHJcbiAgICAgICAgaGludENvbnRlbnQ6IG1hcmtzW2ldLmhpbnRDb250ZW50XHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXHJcbiAgICAgICAgaWNvbkltYWdlSHJlZjogJy4vaW1nL21hcmtlci5wbmcnLFxyXG4gICAgICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddLFxyXG4gICAgICAgIGljb25JbWFnZU9mZnNldDogWy0yMywgLTU3XVxyXG4gICAgICB9KTtcclxuICB9XHJcbiAgdmFyIGNsdXN0ZXJlciA9IG5ldyB5bWFwcy5DbHVzdGVyZXIoe1xyXG4gICAgY2x1c3Rlckljb25zOiBbXHJcbiAgICAgIHtcclxuICAgICAgICBocmVmOiAnLi9pbWcvbWFya2VyLnBuZycsXHJcbiAgICAgICAgc2l6ZTogWzQ2LCA1N10sXHJcbiAgICAgICAgb2Zmc2V0OiBbLTIzLCAtNTddXHJcbiAgICAgIH1cclxuICAgIF0sXHJcbiAgICBjbHVzdGVySWNvbkNvbnRlbnRMYXlvdXQ6IG51bGxcclxuICB9KTtcclxuICBtYXAuZ2VvT2JqZWN0cy5hZGQoY2x1c3RlcmVyKTtcclxuICBjbHVzdGVyZXIuYWRkKGdlb09iamVjdHMpO1xyXG59IiwiY29uc3QgbWVudSA9IChmdW5jdGlvbigpIHtcclxuICBsZXQgYnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1lbnUtYnRuJyk7XHJcbiAgbGV0IGhlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oZWFkZXInKTtcclxuICBsZXQgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcclxuICBsZXQgbmF2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm5hdl9fbGlzdCcpO1xyXG4gIGxldCBhY3QgPSBmYWxzZTtcclxuXHJcbiAgZnVuY3Rpb24gdG9nZ2xlTWVudSgpIHtcclxuICAgICAgYnV0dG9uLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG4gICAgICBoZWFkZXIuY2xhc3NMaXN0LnRvZ2dsZSgnaXMtYWN0aXZlJyk7XHJcbiAgICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSgnbG9ja2VkJyk7XHJcblxyXG4gICAgICBhY3QgPyBhY3QgPSBmYWxzZSA6IGFjdCA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBsZXQgYWRkTGlzdGVuZXJzID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdG9nZ2xlTWVudSk7XHJcblxyXG4gICAgICAgIG5hdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xyXG4gICAgICAgICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xyXG4gICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoJ25hdl9fbGluaycpICYmIGJvZHkub2Zmc2V0V2lkdGggPD0gNzY4KSB7XHJcbiAgICAgICAgICAgIHRvZ2dsZU1lbnUoKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24oZSl7XHJcbiAgICAgICAgaWYgKGUua2V5Q29kZSA9PSAyNyAmJiBhY3QpIHtcclxuICAgICAgICAgIHRvZ2dsZU1lbnUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pXHJcbiAgcmV0dXJuIHtcclxuICAgIG1lbnVPdmVyOiBhZGRMaXN0ZW5lcnMgIFxyXG4gIH1cclxufSgpKTtcclxubWVudS5tZW51T3ZlcigpOyIsImxldCBPbmVQYWdlU2Nyb2xsID0gZnVuY3Rpb24oKXtcclxuICBjb25zdCBkID0gZG9jdW1lbnQ7XHJcbiAgY29uc3Qgd3JhcHBlciA9IGQucXVlcnlTZWxlY3RvcignLndyYXBwZXInKTtcclxuICBjb25zdCBjb250ZW50ID0gZC5xdWVyeVNlbGVjdG9yKCcjY29udGVudCcpO1xyXG4gIGNvbnN0IHNlY3Rpb25zID0gZC5xdWVyeVNlbGVjdG9yQWxsKCcuc2VjdGlvbicpO1xyXG4gIGNvbnN0IG1lbnVMaW5rcyA9IGQucXVlcnlTZWxlY3RvckFsbCgnLm5hdl9fbGluaycpOyAgXHJcbiAgY29uc3QgcG9pbnRzID0gZC5xdWVyeVNlbGVjdG9yQWxsKCcubGlzdGluZ19faXRlbScpO1xyXG4gIGNvbnN0IGxpc3RpbmcgPSBkLnF1ZXJ5U2VsZWN0b3IoJy5saXN0aW5nJyk7XHJcbiAgbGV0IHBhdXNlID0gZmFsc2U7XHJcbiAgbGV0IGNsaWVudFk7XHJcbiAgY29uc3QgaXNNb2JpbGUgPSAvQW5kcm9pZHxBcHBsZVdlYktpdHx3ZWJPU3xpUGhvbmV8aVBhZHxpUG9kfEJsYWNrQmVycnl8SUVNb2JpbGV8T3BlcmEgTWluaS9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbiAgXHJcbiAgZnVuY3Rpb24gbW92ZUNvbnRlbnQoaW5kZXgpIHtcclxuICAgIGlmICghcGF1c2UpIHtcclxuICAgICAgcGF1c2UgPSB0cnVlO1xyXG4gICAgICBsZXQgcG9zID0gaW5kZXggKiAtMTAwICsgJyUnO1xyXG4gICAgICBjb250ZW50LnN0eWxlLnRvcCA9IHBvczsgICAgXHJcblxyXG4gICAgICAvLyDRgdC80LXQvdCwINGG0LLQtdGC0LAgcG9pbnRzXHJcbiAgICAgIGxldCBjdXJyZW50U2VjdGlvbiA9IHNlY3Rpb25zW2luZGV4XTtcclxuICAgICAgaWYgKCFjdXJyZW50U2VjdGlvbi5jbGFzc0xpc3QuY29udGFpbnMoJ3doaXRlJykpIHtcclxuICAgICAgICBsaXN0aW5nLmNsYXNzTGlzdC5hZGQoJ2dyZXknKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsaXN0aW5nLmNsYXNzTGlzdC5yZW1vdmUoJ2dyZXknKTtcclxuICAgICAgfVxyXG4gICAgXHJcbiAgICAgIGxldCBhY3RpdmUgPSBkLnF1ZXJ5U2VsZWN0b3IoJy5saXN0aW5nX19pdGVtLmlzLWFjdGl2ZScpO1xyXG4gICAgICBhY3RpdmUuY2xhc3NMaXN0LnJlbW92ZSgnaXMtYWN0aXZlJyk7XHJcbiAgICAgIHBvaW50c1tpbmRleF0uY2xhc3NMaXN0LmFkZCgnaXMtYWN0aXZlJyk7XHJcblxyXG4gICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgeyAgICAgICAgIFxyXG4gICAgICAgIHBhdXNlID0gZmFsc2U7XHJcbiAgICAgIH0sIDkwMClcclxuICAgIH0gICBcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNjcm9sbFRvKHdheSkge1xyXG4gICAgbGV0IGN1cnJlbnRJbmRleCA9ICFjb250ZW50LnN0eWxlLnRvcCA/IDAgOiAtcGFyc2VJbnQoY29udGVudC5zdHlsZS50b3ApLzEwMDtcclxuICAgIGlmICh3YXkgPT0gJ3VwJyAmJiBjdXJyZW50SW5kZXggPiAwKSB7ICAgICAgXHJcbiAgICAgIG1vdmVDb250ZW50KGN1cnJlbnRJbmRleC0xKTtcclxuICAgIH1cclxuICAgIGlmKHdheSA9PSAnZG93bicgJiYgY3VycmVudEluZGV4IDwgc2VjdGlvbnMubGVuZ3RoLTEpIHtcclxuICAgICAgbW92ZUNvbnRlbnQoY3VycmVudEluZGV4KzEpO1xyXG4gICAgfSBcclxuICB9XHJcblxyXG4gIHdyYXBwZXIuYWRkRXZlbnRMaXN0ZW5lcignd2hlZWwnLCBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgd2F5ID0gZS5kZWx0YVkgPCAwID8gJ3VwJyA6ICdkb3duJztcclxuICAgIHNjcm9sbFRvKHdheSk7XHJcbiAgfSlcclxuICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpIHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICB9KVxyXG5cclxuICB3cmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoc3RhcnQnLCBmdW5jdGlvbihlKSB7XHJcbiAgICBpZiAoaXNNb2JpbGUpIHtcclxuICAgICAgY2xpZW50WSA9IGUudG91Y2hlc1swXS5jbGllbnRZO1xyXG4gICAgfVxyXG4gIH0sIGZhbHNlKTtcclxuXHJcbiAgd3JhcHBlci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGZ1bmN0aW9uKGUpIHsgICAgICBcclxuICAgICAgbGV0IGRlbHRhWSA9IGUuY2hhbmdlZFRvdWNoZXNbMF0uY2xpZW50WSAtIGNsaWVudFk7XHJcbiAgICAgIGlmIChNYXRoLmFicyhkZWx0YVkpPjUwKXtcclxuICAgICAgICBsZXQgd2F5ID0gZGVsdGFZID4gMCA/ICd1cCcgOiAnZG93bic7XHJcbiAgICAgICAgc2Nyb2xsVG8od2F5KTtcclxuICAgICAgfVxyXG4gIH0sIGZhbHNlKTtcclxuXHJcbiAgbWVudUxpbmtzLmZvckVhY2goZnVuY3Rpb24oZWxlbSkgeyAgICBcclxuICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKXtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBsZXQgaW5kZXggPSB0aGlzLmRhdGFzZXQuaW5kZXg7ICBcclxuICAgICAgbW92ZUNvbnRlbnQoaW5kZXgpO1xyXG4gICAgfSkgICAgICBcclxuICB9KVxyXG5cclxuICBsaXN0aW5nLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgbGV0IGxpbmsgPSBlLnRhcmdldDtcclxuICAgIGlmKGxpbmsuY2xhc3NMaXN0LmNvbnRhaW5zKCdsaXN0aW5nX19saW5rJykpIHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOyAgICAgIFxyXG4gICAgICBsZXQgaW5kZXggPSBsaW5rLmRhdGFzZXQuaW5kZXg7XHJcbiAgICAgIG1vdmVDb250ZW50KGluZGV4KTtcclxuICAgIH1cclxuICB9KVxyXG5cclxuICBsZXQgYnV0dG9ucyA9IGQucXVlcnlTZWxlY3RvckFsbCgnLmJ1dHRvbi1saW5rJyk7XHJcbiAgYnV0dG9ucy5mb3JFYWNoKGZ1bmN0aW9uKGVsZW0pIHtcclxuICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBsZXQgaW5kZXggPSB0aGlzLmRhdGFzZXQuaW5kZXg7XHJcbiAgICBtb3ZlQ29udGVudChpbmRleCk7XHJcbiAgICB9KVxyXG4gIH0pXHJcblxyXG4gIGQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihlKSB7XHJcbiAgICBsZXQgd2F5O1xyXG4gICAgaWYgKGUua2V5Q29kZSA9PT0gMzgpIHtcclxuICAgICAgd2F5ID0gJ3VwJztcclxuICAgIH1cclxuICAgIGlmIChlLmtleUNvZGUgPT09IDQwKSB7XHJcbiAgICAgIHdheSA9ICdkb3duJztcclxuICAgICB9XHJcbiAgICAgc2Nyb2xsVG8od2F5KTtcclxuICB9KVxyXG59XHJcbk9uZVBhZ2VTY3JvbGwoKTsiLCJjb25zdCBvdmVybGF5ID0gKGZ1bmN0aW9uKCl7XHJcbiAgbGV0IGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdib2R5Jyk7XHJcbiAgbGV0IG1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1vZGFsJyk7XHJcbiAgbGV0IG1vZGFsSW5uZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcubW9kYWxfX2lubmVyJyk7ICBcclxuXHJcbiAgbGV0IG1vZGFsVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIG1vZGFsVGV4dC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9fdGV4dCcpOyAgXHJcblxyXG4gIGxldCBvcGVuT3ZlcmxheSA9IGZ1bmN0aW9uKGNvbnRlbnQsIHJlcGx5KSB7XHJcbiAgICBsZXQgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgICBtb2RhbFRleHQudGV4dENvbnRlbnQgPSBjb250ZW50O1xyXG4gICAgbW9kYWxJbm5lci5pbm5lckhUTUwgPSBcIlwiO1xyXG4gICAgaWYocmVwbHkpIHtcclxuICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ29yZGVyLWJ1dHRvbicpO1xyXG4gICAgICBidXR0b24udGV4dENvbnRlbnQgPSAn0JfQsNC60YDRi9GC0YwnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ21vZGFsX19jbG9zZScpO1xyXG4gICAgfVxyXG4gICAgbW9kYWxJbm5lci5hcHBlbmRDaGlsZChtb2RhbFRleHQpO1xyXG4gICAgbW9kYWxJbm5lci5hcHBlbmRDaGlsZChidXR0b24pO1xyXG5cclxuICAgIG1vZGFsLmNsYXNzTGlzdC5hZGQoJ2lzLWFjdGl2ZScpO1xyXG4gICAgYm9keS5jbGFzc0xpc3QuYWRkKCdsb2NrZWQnKTtcclxuXHJcbiAgICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGNsb3NlT3ZlcmxheSgpO1xyXG4gICAgfSlcclxuXHJcbiAgICBtb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgIGlmIChlLnRhcmdldCA9PT0gbW9kYWwpIHtcclxuICAgICAgICBjbG9zZU92ZXJsYXkoKTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuXHJcbiAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgKGUpID0+IHtcclxuICAgICAgaWYgKGUua2V5Q29kZSA9PT0gMjcpIFxyXG4gICAgICAgIGNsb3NlT3ZlcmxheSgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBsZXQgY2xvc2VPdmVybGF5ID0gZnVuY3Rpb24oKSB7XHJcbiAgICBtb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdpcy1hY3RpdmUnKTtcclxuICAgIGJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnbG9ja2VkJyk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4ge1xyXG4gICAgb3Blbjogb3Blbk92ZXJsYXksXHJcbiAgICBjbG9zZTogY2xvc2VPdmVybGF5XHJcbiAgfTtcclxufSgpKTtcclxuXHJcbmNvbnN0IGFqYXhGb3JtID0gZnVuY3Rpb24oZm9ybSkge1xyXG4gXHJcbiAgbGV0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIGRhdGEuYXBwZW5kKFwibmFtZVwiLCBmb3JtLmVsZW1lbnRzLm5hbWUudmFsdWUpO1xyXG4gICAgZGF0YS5hcHBlbmQoXCJwaG9uZVwiLCBmb3JtLmVsZW1lbnRzLnBob25lLnZhbHVlKTtcclxuICAgIGRhdGEuYXBwZW5kKFwiY29tbWVudFwiLCBmb3JtLmVsZW1lbnRzLnRleHRhcmVhLnZhbHVlKTtcclxuICAgIGRhdGEuYXBwZW5kKFwidG9cIiwgXCJjbGllbnRAbWFpbC5ydVwiKTtcclxuICBcclxuICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xyXG4gICAgeGhyLnJlc3BvbnNlVHlwZSA9ICdqc29uJztcclxuICAgIHhoci5vcGVuKCdQT1NUJywnaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsJyk7XHJcbiAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIlgtUmVxdWVzdGVkLVdpdGhcIiwgXCJYTUxIdHRwUmVxdWVzdFwiKTtcclxuICAgIHhoci5zZW5kKGRhdGEpO1xyXG5cclxuICAgIHJldHVybiB4aHI7XHJcbiAgXHJcbn1cclxuXHJcbmNvbnN0IHN1Ym1pdEZvcm0gPSBmdW5jdGlvbigpIHsgIFxyXG4gIGxldCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI29yZGVyLWZvcm0nKTtcclxuICBpZiAodmFsaWRhdGVGb3JtKGZvcm0pKSB7XHJcbiAgICBcclxuICBsZXQgcmVxdWVzdCA9IGFqYXhGb3JtKGZvcm0pOyAgXHJcbiAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCAoKT0+IHtcclxuICAgICAgbGV0IHJlcGx5ID0gZmFsc2U7XHJcbiAgICAgIGlmIChyZXF1ZXN0LnN0YXR1cyA+PTQwMCkge1xyXG4gICAgICAgIGxldCBjb250ZW50ID0gJ9Ce0YjQuNCx0LrQsCDRgdC+0LXQtNC40L3QtdC90LjRjyDRgSDRgdC10YDQstC10YDQvtC8LCDQv9C+0L/RgNC+0LHRg9C50YLQtSDQv9C+0LfQttC1JztcclxuICAgICAgICBvdmVybGF5Lm9wZW4oYCR7Y29udGVudH0uINCe0YjQuNCx0LrQsCAke3JlcXVlc3Quc3RhdHVzfWAsIHJlcGx5KTtcclxuICAgICAgfSBlbHNlIGlmIChyZXF1ZXN0LnJlc3BvbnNlLnN0YXR1cyA9PSAwKSB7XHJcbiAgICAgICAgY29udGVudCA9IHJlcXVlc3QucmVzcG9uc2UubWVzc2FnZTtcclxuICAgICAgICBvdmVybGF5Lm9wZW4oY29udGVudCwgcmVwbHkpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnRlbnQgPSAn0KHQvtC+0LHRidC10L3QuNC1INC+0YLQv9GA0LDQstC70LXQvdC+JztcclxuICAgICAgICByZXBseSA9IHRydWU7XHJcbiAgICAgICAgb3ZlcmxheS5vcGVuKGNvbnRlbnQsIHJlcGx5KTtcclxuICAgICAgfVxyXG4gICAgfSlcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHZhbGlkYXRlRm9ybShmb3JtKSB7XHJcbiAgbGV0IHZhbGlkID0gdHJ1ZTtcclxuICBpZighdmFsaWRhdGVGaWVsZChmb3JtLmVsZW1lbnRzLm5hbWUpKSB7XHJcbiAgICB2YWxpZCA9IGZhbHNlO1xyXG4gIH1cclxuICBpZighdmFsaWRhdGVGaWVsZChmb3JtLmVsZW1lbnRzLnBob25lKSkge1xyXG4gICAgdmFsaWQgPSBmYWxzZTtcclxuICB9XHJcbiAgaWYoIXZhbGlkYXRlRmllbGQoZm9ybS5lbGVtZW50cy50ZXh0YXJlYSkpIHtcclxuICAgIHZhbGlkID0gZmFsc2U7XHJcbiAgfVxyXG4gIHJldHVybiB2YWxpZDtcclxufVxyXG5mdW5jdGlvbiB2YWxpZGF0ZUZpZWxkKGZpZWxkKSB7XHJcbiAgZmllbGQubmV4dEVsZW1lbnRTaWJsaW5nLnRleHRDb250ZW50ID0gZmllbGQudmFsaWRhdGlvbk1lc3NhZ2U7XHJcbiAgcmV0dXJuIGZpZWxkLmNoZWNrVmFsaWRpdHkoKTtcclxufVxyXG5cclxubGV0IG9yZGVyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlbmQnKTtcclxub3JkZXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc3VibWl0Rm9ybSgpO1xyXG59KTsiLCIoZnVuY3Rpb24oKXtcclxuICBjb25zdCBpdGVtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5yZXZpZXdzX19pdGVtJyk7XHJcbiAgY29uc3QgcGl4ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnJldmlld3NfX3BpeC1pdGVtJyk7XHJcbiAgbGV0IGFjdGl2ZSA9IDA7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgaXRlbXMubGVuZ3RoOyBpKyspIHtcclxuICAgIHBpeFtpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBpdGVtc1tpXS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuICAgICAgcGl4W2ldLmNsYXNzTGlzdC50b2dnbGUoJ2lzLWFjdGl2ZScpO1xyXG4gICAgIFxyXG4gICAgICBwaXhbYWN0aXZlXS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuICAgICAgaXRlbXNbYWN0aXZlXS5jbGFzc0xpc3QudG9nZ2xlKCdpcy1hY3RpdmUnKTtcclxuICAgICAgYWN0aXZlID0gaTsgICAgIFxyXG4gICAgfSlcclxuICB9XHJcbn0oKSk7IiwiZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uKCkge1xyXG4gIGxldCB2aWRlb1BsYXllciA9IGZ1bmN0aW9uKCkge1xyXG4gICAgbGV0IHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX19jb250ZW50Jyk7XHJcbiAgICBsZXQgcGxheUJpZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fYnRuJyk7XHJcbiAgICBsZXQgcGxheVNtYWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX19wbGF5Jyk7XHJcbiAgICBsZXQgdm9sdW1lU2NhbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3JhbmdlLS12b2x1bWUnKTtcclxuICAgIGxldCBwcm9ncmVzc1NjYWxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX19yYW5nZS0tcHJvZ3Jlc3MnKTsgICAgXHJcbiAgICBsZXQgbXV0ZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fc291bmQtaW1nJyk7XHJcbiAgICBsZXQgdHVybk9uID0gZmFsc2U7XHJcbiAgICB2b2x1bWVTY2FsZS5taW4gPSAwO1xyXG4gICAgdm9sdW1lU2NhbGUubWF4ID0gMTA7XHJcbiAgICBwcm9ncmVzc1NjYWxlLnZhbHVlID0gMDsgICAgXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHZpZGVvVHVybigpIHtcclxuICAgICAgcHJvZ3Jlc3NTY2FsZS5tYXggPSAxMDA7XHJcbiAgICAgIHR1cm5PbiA9IHRydWU7XHJcbiAgICAgIGdldER1cmF0aW9uKCk7XHJcbiAgICB9ICAgIFxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBwbGF5U3RvcCgpIHsgICAgICBcclxuICAgICAgdG9nZ2xlQ2xhc3MoKTtcclxuICAgICAgaWYgKHZpZGVvLnBhdXNlZCkge1xyXG4gICAgICAgIHZpZGVvLnBsYXkoKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB2aWRlby5wYXVzZSgpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHRvZ2dsZUNsYXNzKCkge1xyXG4gICAgICBwbGF5QmlnLmNsYXNzTGlzdC50b2dnbGUoJ2hpZGRlbicpO1xyXG4gICAgICBwbGF5U21hbGwuY2xhc3NMaXN0LnRvZ2dsZSgncGF1c2UnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gcHJvZ3Jlc3NVcGRhdGUoKSB7XHJcbiAgICAgIGxldCBkdXJhdGlvbiA9IHZpZGVvLmR1cmF0aW9uO1xyXG4gICAgICBsZXQgdGltZSA9IHZpZGVvLmN1cnJlbnRUaW1lO1xyXG4gICAgICBsZXQgbWF4ID0gcHJvZ3Jlc3NTY2FsZS5tYXg7XHJcbiAgICAgIHByb2dyZXNzU2NhbGUudmFsdWUgPSAodGltZS9kdXJhdGlvbikqbWF4O1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBwcm9ncmVzc0NoYW5nZSgpIHtcclxuICAgICAgbGV0IHBvcyA9IHByb2dyZXNzU2NhbGUudmFsdWU7XHJcbiAgICAgIGxldCBtYXggPSBwcm9ncmVzc1NjYWxlLm1heDtcclxuICAgICAgdmlkZW8uY3VycmVudFRpbWUgPSB2aWRlby5kdXJhdGlvbioocG9zL21heCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdm9sdW1lQ2hhbmdlKCkge1xyXG4gICAgICBsZXQgdmFsdWUgPSB2b2x1bWVTY2FsZS52YWx1ZTtcclxuICAgICAgdmlkZW8udm9sdW1lID0gdmFsdWUvMTA7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gbXV0ZSgpIHtcclxuICAgICAgaWYgKHZpZGVvLnZvbHVtZSA9PT0gMCkge1xyXG4gICAgICAgIHZpZGVvLnZvbHVtZSA9IHNvdW5kTGV2ZWw7XHJcbiAgICAgICAgdm9sdW1lU2NhbGUudmFsdWUgPSBzb3VuZExldmVsKjEwO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNvdW5kTGV2ZWwgPSB2aWRlby52b2x1bWU7XHJcbiAgICAgICAgdmlkZW8udm9sdW1lID0gMDtcclxuICAgICAgICB2b2x1bWVTY2FsZS52YWx1ZSA9IDA7XHJcbiAgICAgIH0gIFxyXG4gICAgfVxyXG5cclxuICAgIC8vINC+0YLQvtCx0YDQsNC20LXQvdC40LUg0YLQtdC60YPRidC10LPQviDQstGA0LXQvNC10L3QuCDQuCDQv9GA0L7QtNC+0LvQttC40YLQtdC70YzQvdC+0YHRgtC4INCy0LjQtNC10L5cclxuICAgIGxldCBlc3RpbWF0ZWREaXNwbGF5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX190aW1lLWVzdGltYXRlZCcpO1xyXG4gICAgbGV0IGNvbXBsZXRlZERpc3BsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3RpbWUtY29tcGxldGVkJyk7XHJcbiAgICBmdW5jdGlvbiBnZXREdXJhdGlvbigpIHtcclxuICAgICAgbGV0IGR1cmF0aW9uID0gdmlkZW8uZHVyYXRpb247XHJcbiAgICAgIGVzdGltYXRlZERpc3BsYXkudGV4dENvbnRlbnQgPSBmb3JtYXRUaW1lKGR1cmF0aW9uKTsgICAgICBcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIHRpbWVVcGRhdGUoKXtcclxuICAgICAgbGV0IGNvbXBsZXRlZCA9IHZpZGVvLmN1cnJlbnRUaW1lO1xyXG4gICAgICBjb21wbGV0ZWREaXNwbGF5LnRleHRDb250ZW50ID0gZm9ybWF0VGltZShjb21wbGV0ZWQpOyAgICAgIFxyXG4gICAgfVxyXG4gICAgZnVuY3Rpb24gZm9ybWF0VGltZSh0aW1lKSB7XHJcbiAgICAgIGxldCByb3VuZFRpbWUgPSBNYXRoLnJvdW5kKHRpbWUpO1xyXG4gICAgICBsZXQgbWludXRlcyA9IE1hdGguZmxvb3Iocm91bmRUaW1lLzYwKTtcclxuICAgICAgbGV0IHNlY29uZHMgPSByb3VuZFRpbWUgLSBtaW51dGVzICogNjA7XHJcbiAgICAgIGxldCBmb3JtYXR0ZWRTZWNvbmRzID0gc2Vjb25kcyA8IDEwID8gYDAke3NlY29uZHN9YDogc2Vjb25kcztcclxuXHJcbiAgICAgIHJldHVybiBgJHttaW51dGVzfToke2Zvcm1hdHRlZFNlY29uZHN9YDtcclxuICAgIH1cclxuXHJcbiAgICAvLyDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5XHJcblxyXG4gICAgcGxheUJpZy5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZpZGVvVHVybigpXHJcbiAgICAgIHBsYXlTdG9wKCk7XHJcbiAgICB9KTtcclxuICAgIHBsYXlTbWFsbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgIHZpZGVvVHVybigpXHJcbiAgICAgIHBsYXlTdG9wKCk7XHJcbiAgICB9KTtcclxuXHJcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCd0aW1ldXBkYXRlJywgZnVuY3Rpb24oKXtcclxuICAgICAgcHJvZ3Jlc3NVcGRhdGUoKTtcclxuICAgICAgdGltZVVwZGF0ZSgpXHJcbiAgICB9ICk7XHJcbiAgICB2aWRlby5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKCl7XHJcbiAgICAgIGlmKHZpZGVvLnBhdXNlZCkgcmV0dXJuO1xyXG4gICAgICAgIHZpZGVvLnBhdXNlKCk7XHJcbiAgICAgICAgdG9nZ2xlQ2xhc3MoKTsgICAgICBcclxuICAgIH0pO1xyXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignZW5kZWQnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHRvZ2dsZUNsYXNzKCk7XHJcbiAgICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIH0sIGZhbHNlKTtcclxuXHJcbiAgICBwcm9ncmVzc1NjYWxlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZG93bicsIGZ1bmN0aW9uKCl7XHJcbiAgICAgIGlmICh0dXJuT24pIHtcclxuICAgICAgICBwbGF5QmlnLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xyXG4gICAgICAgIHBsYXlTbWFsbC5jbGFzc0xpc3QuYWRkKCdwYXVzZScpO1xyXG4gICAgICB9O1xyXG4gICAgICB2aWRlby5wYXVzZSgpO1xyXG4gICAgfSlcclxuICAgIHByb2dyZXNzU2NhbGUuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCBwcm9ncmVzc0NoYW5nZSk7XHJcbiAgICBwcm9ncmVzc1NjYWxlLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNldXAnLCBmdW5jdGlvbigpe1xyXG4gICAgICBpZighdHVybk9uKSByZXR1cm47XHJcbiAgICAgIHZpZGVvLnBsYXkoKTsgICAgICBcclxuICAgIH0pXHJcbiAgICAgIFxyXG4gICAgdm9sdW1lU2NhbGUuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCB2b2x1bWVDaGFuZ2UpO1xyXG4gICAgbXV0ZUJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG11dGUpO1xyXG4gICAgXHJcbiAgfVxyXG4gIHZpZGVvUGxheWVyKCk7XHJcbn0sIGZhbHNlKTtcclxuIl19
